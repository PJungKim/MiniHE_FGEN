# 자체 함수 발생기 및 파워서플라이

SW와의 협업을 위한 Git 공간입니다.


## Recent Updates

- 2026.01.17
  - 메뉴 형식 추가(세부 메뉴는 회로와 이야기를 나눠서 진행)


## Pin Assignment

- 핀 할당은 [이 링크](https://docs.google.com/spreadsheets/d/1osE8z-Co1EeT5PN4M1Yoa0Kntycml3w9QEv3WA9FsDo/edit?gid=0#gid=0)에 들어가서 편집 부탁 드립니다.
  - 해당 링크는 핀맵이 최종 확정되는 대로 내릴 예정입니다.
- 현재 Pin 할당표
- 개인정보 보호를 위해 이름은 성씨만 적었습니다. 
  <br>
  |GPIO|사용목적|담당자|
  |---|---|---|
  |0|청문회 심의 대상|강|
  |1|청문회 심의 대상|강|
  |2|||
  |A0|ADC|이|
  |A1|ADC|이|
  |A2|ADC|강|
  |A3|ADC|강|
  |A4|DAC|강|

- 버튼 할당표
  - 버튼은 1, 2, 3, 5, 6, 7 모두 사용한다.
  - 버튼 할당표는 아래와 같다.
    |버튼|기능|버튼|기능|
    |---|---|---|---|
    |1|출력|5|뒤로|
    |2|탭|6|Enter|
    |3|-|7|+|

## 시나리오 논의

### 1. 함수 발생기쪽

- 캘리브레이션
  - 포토커플러는 비선형 소자로 별도의 캘리브레이션이 진행되어야 매끄러운 파형 출력이 기대됨.
  - 함수 발생기의 출력 눈금을 정하는 기능
  - 캘리브레이션때만 아이솔레이션을 잠시 해제하고 캘리브레이션이 끝난 후에는 다시 아이솔레이션 진행
  - D/A 캘리브레이션과 A/D 피드백 캘리브레이션 둘다 진행하면 좋으나, 기술적으로 오실로스코프 기능은 포함하지 않을 예정으로, 실제로는 D/A 캘리만 진행
  - 캘리브레이션 코드는 405 함수발생기 전용으로 선행개발 예정으로 C언어로 짤 예정.

- 파라미터 세팅
  - Wave 종류: Sine, Square, Ramp, Pulse
  - 주요 파라미터 : Offset, Peak-to-Peak, Duty Cycle

- 각각의 파라미터 값 변경은 버튼을 이용하여 진행한다.
- 추가 동작 시나리오 생각나는거 있으면 적으시기 바랍니다.

### 2. 파워서플라이쪽

- PWM Parameter: PWM채널에 따라 96MHz~192MHz의 클럭 소스로 동작, Prescaler를 거쳐 48MHz로 맞출 예정
- 전압 분해능을 얼마로 하느냐가 중요
  - 분해능을 1000단계로 하면(0.00~10.00으로 0.01V 조절) PWM 주파수는 48kHz에서 대응되도록 설계해야함. 분해능 100단계면 480kHz에서 대응되도록 함.

- 파라미터 : 출력 전압 하나면 끝
- 일반 파워서플라이 벤치마킹 : 전류측정기능이랑 출력전압 감지기능 ㅇㄴㅌㅁ에 표시

## 메뉴

- 스위치를 어떻게 쓰는지....
  - 1, 2, 3, 5, 6, 7 : 파워쪽 회로 설계자가 스위치를 6개 다 박으면 이렇게 쓰고, 스위치를 일부만 박으면 조금 달라질 수 있음.
  - 6개 다 쓰는 경우


- 메뉴
  - 대분류 : 파워서플라이부문 / 함수 발생기 부문 / 잡다한 설정(버튼누르는거, 유아트 통신 설정 뭐 그런거)
    - Starlit 소스 코드
      ```Py
      menuList = ["Power\nSupply", "Func\nGen", "Other"]
      menuFunc = [NULL, NULL, NULL]
      menuIdx = 0

      loop
          /// ㅇㄴㅌㅁ에 메뉴를 출력한다.
          OLED << f"/0/rMenu - /y{menuIdx}:" <<f"/1/A/b{menuList[menuIdx]}"
          /// 버튼을 누를 때까지 대기한다.
          while !(sw = InSwitch())
          ///버튼 누른 값에 대하여 실행
          if sw == BUTTON_2
              menuIdx += 1
              menuIdx %%= length(menuList)
          elif sw == BUTTON_1
              menuIdx -= 1
              menuIdx %%= length(menuList)
      ```





|번호|OLED 출력|기능|
|--|--|--|
|1|`DA Calibration`|DAC 출력 눈금 조정|
|2|`AD Calibration`|ADC 출력 눈금 조정|
|3|`Voltage Test`|함수 발생기에 출력되는 전압이 맞는지 테스트합니다.|
|4|`Set Parameter`|파라미터 값을 수정합니다.|


